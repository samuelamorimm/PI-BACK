{% load static %}

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Agendamento</title>
    <link rel="stylesheet" href="{% static 'src/css/style.css'%}">
    <link rel="shortcut icon" href="{% static 'src/img/logo-icon.png'%}" type="image/x-icon">

</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <img class="logo" src="{% static 'src/img/logo-icon.png'%}" alt="">
            <ul>
                <li><a href="#">Início</a></li>
                <li><a href="index.html">Administração</a></li>
                <li><a href="#">Agendar</a></li>
                <li><a href="medicos.html">Médicos</a></li>
                <li><a href="especialidades.html">especialidades</a></li>
            </ul>
        </nav>

        <!-- Agendamento -->
        <div class="main-content">
            <h1>Realize o Agendamento</h1>
            <form id="formAgendamento" method="post" action="{% url 'agendar' %}">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required>

                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" name="cpf" required maxlength="11">

                <label for="data">Data:</label>
                <input type="date" id="id_data" name="data" required>

                <label for="pagamento">Pagamento:</label>
                <select name="pagamento" id="pagamento">
                    <option value="pix">Pix</option>
                    <option value="cartão">Cartão</option>
                    <option value="dinheiro">Dinheiro</option>
                </select>

                <label for="servico">Serviço:</label>
                <select id="id_servico" name="servico">
                    <option value="consulta">Consulta</option>
                </select>

                <button type="submit">Agendar</button>
            </form>
        </div>
    </div>

    <!-- Modal personalizado -->
    <div id="customAlert">
      <div class="alert-container">
        <div class="alert-title" id="alertTitle">Agendamento Realizado! </div>
        <div class="alert-content" id="alertContent">
          <img src="src/img/check.png" alt="">
        </div>

        <div class="alert-footer">
          <button class="close-btn" onclick="closeAlert()">Fechar</button>
        </div>
      
    </div>
    
    <script src="src/js/script.js"></script>
    <script>
        document.getElementById('id_data').addEventListener('change', function() {
            var dataSelecionada = this.value
        
            if (dataSelecionada) {
                fetch(`/buscar-servicos/${dataSelecionada}/`)
                .then(response => response.json())
                .then(data => {
                    var servicoSelect = document.getElementById('id_servico');
                    servicoSelect.innerHTML = '<option value="">Selecione um serviço</option>'
        
                    if (data.servicos.length === 0) {
                        // Se não houver serviços, exibe a mensagem "Sem serviços para esta data"
                        var option = document.createElement('option');
                        option.value = '';
                        option.textContent = 'Sem serviços para esta data';
                        option.style.color = 'red'
                        servicoSelect.appendChild(option);
                    } else {
                        // Caso haja serviços, adiciona as opções
                        data.servicos.forEach(function(servico) {
                            var option = document.createElement('option');
                            option.value = servico.id;
                            option.textContent = servico.servico || 'Serviço não disponível'; // Caso algum serviço não tenha nome
                            servicoSelect.appendChild(option);
                        });
                    }
                })
            }       
        })
    </script>
</body>
</html>
